#!/usr/bin/env ruby
require File.expand_path('../../lib/rutt.rb', __FILE__)
require 'fileutils'
require 'yaml'

RIP_ROOT = '~/Audio/rutt'
MP3_ROOT = '~/Audio/Lossy'
FLAC_ROOT= '~/Audio/Lossless'

album = Album.from_cdrom
#album.songs.each do |song|
#    puts song.mp3_filename
#    puts song.flac_filename
#    puts song.song_info.track_name
#end


path  = File.expand_path("#{RIP_ROOT}/#{album.discid}")
FileUtils.mkpath(path)

yaml_path = "#{path}/cd_info.yml"
unless File.exists?(yaml_path)
    puts "Writing meta info to #{yaml_path}"
    File.open(yaml_path,"w+") do |file|
        file.puts album.to_yaml
    end
end

# Open Editor for CD Info
## Include Disc #, Year
system("/usr/bin/editor #{yaml_path}")
album = YAML.load_file(yaml_path)
album.update_songs


# Rip CD to WAV
wav_path = "#{path}/wav"
puts "Ripping #{album.name} by #{album.artist} from #{album.date} to wav at #{wav_path}"
FileUtils.mkpath(wav_path)
Ripper.rip_cd_to_wav(wav_path)

# Rip WAV to MP3
tmp_mp3_path = "#{path}/mp3"
## Tag in id3v2

# Rip WAV to Flac
tmp_flac_path = "#{path}/flac"
## Tag in metaflac
